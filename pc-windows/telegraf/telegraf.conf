# =============================================================================
# Telegraf Configuration - PC Windows Monitoring Dashboard
# =============================================================================
# Questo file configura Telegraf per raccogliere metriche hardware dal PC
# e inviarle a InfluxDB sul telefono server.
#
# ISTRUZIONI:
# 1. Sostituire PHONE_SERVER_IP con l'IP del telefono server (es. 192.168.1.28)
# 2. Copiare questo file in C:\telegraf\telegraf.conf
# 3. Avviare Telegraf come servizio Windows
# =============================================================================

[global_tags]
  host = "pc-windows"

[agent]
  interval = "1s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  precision = "0s"
  hostname = "pc-windows"

# =============================================================================
# OUTPUT - Invio dati a InfluxDB sul telefono server
# =============================================================================
[[outputs.influxdb]]
  urls = ["http://192.168.1.28:8086"]
  database = "pc_metrics"
  retention_policy = "30days"
  timeout = "5s"

# =============================================================================
# INPUT - Metriche CPU
# =============================================================================
[[inputs.win_perf_counters]]
  [[inputs.win_perf_counters.object]]
    ObjectName = "Processor"
    Counters = [
      "% Processor Time",
      "% Idle Time",
      "% Interrupt Time",
      "% Privileged Time",
      "% User Time"
    ]
    Instances = ["_Total"]
    Measurement = "cpu"

  [[inputs.win_perf_counters.object]]
    ObjectName = "Processor Information"
    Counters = [
      "% Processor Utility",
      "Processor Frequency"
    ]
    Instances = ["_Total"]
    Measurement = "cpu_info"

# =============================================================================
# INPUT - Metriche Memoria RAM
# =============================================================================
  [[inputs.win_perf_counters.object]]
    ObjectName = "Memory"
    Counters = [
      "Available MBytes",
      "% Committed Bytes In Use",
      "Cache Bytes",
      "Pool Nonpaged Bytes",
      "Pool Paged Bytes",
      "Pages/sec"
    ]
    Instances = ["------"]
    Measurement = "mem"

# =============================================================================
# INPUT - Metriche Disco
# =============================================================================
  [[inputs.win_perf_counters.object]]
    ObjectName = "LogicalDisk"
    Counters = [
      "% Free Space",
      "Free Megabytes",
      "% Disk Time",
      "Disk Read Bytes/sec",
      "Disk Write Bytes/sec",
      "Current Disk Queue Length"
    ]
    Instances = ["C:", "D:", "_Total"]
    Measurement = "disk"

  [[inputs.win_perf_counters.object]]
    ObjectName = "PhysicalDisk"
    Counters = [
      "% Disk Time",
      "Disk Read Bytes/sec",
      "Disk Write Bytes/sec",
      "Avg. Disk Queue Length"
    ]
    Instances = ["_Total"]
    Measurement = "disk_physical"

# =============================================================================
# INPUT - Metriche Rete
# =============================================================================
  [[inputs.win_perf_counters.object]]
    ObjectName = "Network Interface"
    Counters = [
      "Bytes Received/sec",
      "Bytes Sent/sec",
      "Packets Received/sec",
      "Packets Sent/sec",
      "Packets Received Errors",
      "Packets Outbound Errors"
    ]
    Instances = ["*"]
    Measurement = "net"

# =============================================================================
# INPUT - Metriche Sistema
# =============================================================================
  [[inputs.win_perf_counters.object]]
    ObjectName = "System"
    Counters = [
      "System Up Time",
      "Processes",
      "Threads",
      "Context Switches/sec"
    ]
    Instances = ["------"]
    Measurement = "system"

  [[inputs.win_perf_counters.object]]
    ObjectName = "Process"
    Counters = [
      "% Processor Time",
      "Working Set"
    ]
    Instances = ["_Total"]
    Measurement = "process"

# =============================================================================
# INPUT - Temperature hardware via script PowerShell (OpenHardwareMonitor/HWiNFO)
# =============================================================================
[[inputs.exec]]
  commands = ["powershell -ExecutionPolicy Bypass -File \"C:\\telegraf\\scripts\\collect-hardware-temps.ps1\""]
  timeout = "5s"
  interval = "1s"
  data_format = "influx"
  name_override = "hardware_temps"

# =============================================================================
# INPUT - Speedtest (ogni 5 minuti)
# =============================================================================
[[inputs.exec]]
  commands = ["powershell -ExecutionPolicy Bypass -File \"C:\\telegraf\\scripts\\collect-speedtest.ps1\""]
  timeout = "120s"
  interval = "300s"
  data_format = "influx"
  name_override = "speedtest"

# =============================================================================
# INPUT - Metriche GPU (NVIDIA via nvidia-smi, se presente)
# =============================================================================
[[inputs.exec]]
  commands = ["powershell -ExecutionPolicy Bypass -File \"C:\\telegraf\\scripts\\collect-gpu.ps1\""]
  timeout = "5s"
  interval = "1s"
  data_format = "influx"
  name_override = "gpu"
